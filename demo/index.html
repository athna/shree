<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SocketReaction</title>
  <script src="/dist/shree.js"></script>
  <script type="x-shader/x-vertex" id="vs">
    attribute vec3 position;
    attribute vec4 color;
    attribute vec2 textureCode;
    uniform mat4 mMatrix;
    uniform mat4 vMatrix;
    uniform mat4 pMatrix;
    uniform mat4 mvMatrix;
    varying vec4 vColor;
    varying vec2 vTextureCode;

    void main(void){
      vColor = color;
      vTextureCode = textureCode;
      vec4 mvPosition = mvMatrix * vec4(position, 1.0);
      gl_Position = pMatrix * mvPosition;
    }
  </script>
  <script type="x-shader/x-fragment" id="fs">
    precision mediump float;
    uniform sampler2D texture;

    varying vec4 vColor;
    varying vec2 vTextureCode;

    void main(void){
      vec4 smpColor = texture2D(texture, vTextureCode);
      // gl_FragColor = vColor * smpColor;
      gl_FragColor = smpColor;
    }
  </script>
</head>
<style>
html,
body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}
#wrapper {
  width: 100%;
  height: 100%;
}
</style>
<body>
  <div id="wrapper"></div>
  <script>
    var img = new Image();
    img.onload = function(event) {
      main();
    }
    img.src = '/demo/map.jpg';

    var main = function() {
      var wrapper = document.getElementById('wrapper');
      var renderer = new SHREE.Renderer();
      wrapper.appendChild(renderer.domElement);
      renderer.setSize(wrapper.clientWidth, wrapper.clientHeight);

      var scene = new SHREE.Scene();

      var geometry = new SHREE.Geometry();
      geometry.addAttribute('position', 3, [
         0.0,  1.5,  0.0,
         1.0,  0.0,  1.0,
         1.0,  0.0, -1.0,
        -1.0,  0.0, -1.0,
        -1.0,  0.0,  1.0,
         0.0, -1.5,  0.0,
      ]);
      geometry.addAttribute('color', 4, [
        1.0, 0.0, 0.0, 1.0, // 赤
        0.0, 1.0, 0.0, 1.0, // 緑
        0.0, 0.0, 1.0, 1.0, // 青
        1.0, 0.0, 1.0, 1.0, // 藍
        0.0, 1.0, 1.0, 1.0, // 水
        1.0, 1.0, 0.0, 1.0  // 黄
      ]);
      geometry.addAttribute('textureCode', 2, [
        1.0, 0.0,
        0.0, 0.0,
        0.0, 1.0,
        1.0, 1.0,
        0.0, 1.0,
        1.0, 0.0,
      ]);
      geometry.index = [
        0, 1, 2,
        0, 2, 3,
        0, 3, 4,
        0, 4, 1,
        5, 2, 1,
        5, 3, 2,
        5, 4, 3,
        5, 1, 4,
      ];

      var material = new SHREE.Material({
        vertexShader: document.getElementById('vs').text,
        fragmentShader: document.getElementById('fs').text,
        map: img
      });

      var mesh = new SHREE.Mesh(geometry, material);

      var group = new SHREE.Object3D();
      group.add(mesh);
      scene.add(group);

      var camera = new SHREE.Camera();
      camera.position.z = 7;

      var count = 0;
      var render = function() {
        count += 2;
        var rad = (count % 360) * Math.PI / 180;
        mesh.scale.x = mesh.scale.y = mesh.scale.z = Math.abs(Math.sin(rad)) * 0.8 + 0.2;
        mesh.rotation.y = rad * 4;
        mesh.position.x = Math.sin(rad) * 5;
        mesh.position.y = Math.cos(rad) * 5;
        group.rotation.y = rad;
        renderer.render(scene, camera);
        requestAnimationFrame(render);
      }

      render();
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SocketReaction</title>
  <script src="/dist/shree.js"></script>
  <script type="x-shader/x-vertex" id="vs">
    attribute vec3 position;
    attribute vec2 textureCode;
    uniform mat4 mMatrix;
    uniform mat4 vMatrix;
    uniform mat4 pMatrix;
    uniform mat4 mvMatrix;
    varying vec2 vTextureCode;

    void main(void){
      vTextureCode = textureCode;
      vec4 mvPosition = mvMatrix * vec4(position, 1.0);
      gl_Position = pMatrix * mvPosition;
    }
  </script>
  <script type="x-shader/x-fragment" id="fs">
    precision mediump float;
    uniform sampler2D texture;
    varying vec2 vTextureCode;

    void main(void){
      gl_FragColor = texture2D(texture, vTextureCode);
    }
  </script>
</head>
<style>
html,
body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}
#wrapper {
  width: 100%;
  height: 100%;
}

#wrapper > canvas {
  vertical-align: bottom;

  -ms-interpolation-mode: nearest-neighbor;   /* IE8+ */
  image-rendering: -webkit-optimize-contrast; /* Safari (WebKit) */
  image-rendering: -moz-crisp-edges;          /* Firefox (Gecko) */
  image-rendering: -o-crisp-edges;            /* Opera 12.x */
  image-rendering: pixelated;                 /* Chrome 41+, Opera 29+ (CSS4) */
}
</style>
<body>
  <div id="wrapper"></div>
  <script>
    var img = new Image();
    img.onload = function(event) {
      main();
    }
    img.src = './uv_checker.png';

    var main = function() {
      var wrapper = document.getElementById('wrapper');
      var renderer = new SHREE.Renderer({
        antialias: false,
      });
      renderer.pixelRatio = 1 / 4;
      renderer.setSize(wrapper.clientWidth, wrapper.clientHeight);
      wrapper.appendChild(renderer.domElement);

      var scene = new SHREE.Scene();

      var geometry = new SHREE.Geometry();
      geometry.addAttribute('position', 3, [
         0.0,  1.5,  0.0,
         1.0,  0.0,  1.0,
         1.0,  0.0, -1.0,
        -1.0,  0.0, -1.0,
        -1.0,  0.0,  1.0,
         0.0, -1.5,  0.0,
      ]);
      geometry.addAttribute('textureCode', 2, [
        1.0, 0.0,
        0.0, 0.0,
        0.0, 1.0,
        1.0, 1.0,
        0.0, 1.0,
        1.0, 0.0,
      ]);
      geometry.index = [
        0, 1, 2,
        0, 2, 3,
        0, 3, 4,
        0, 4, 1,
        5, 2, 1,
        5, 3, 2,
        5, 4, 3,
        5, 1, 4,
      ];

      var material = new SHREE.Material({
        vertexShader: document.getElementById('vs').text,
        fragmentShader: document.getElementById('fs').text,
        uniforms: {
          texture: {
            type: 't',
            value: img,
          }
        }
      });

      var mesh = new SHREE.Mesh(geometry, material);

      var group = new SHREE.Object3D();
      group.add(mesh);
      scene.add(group);

      var camera = new SHREE.Camera();
      camera.position.y = 2;
      camera.position.z = 7;
      camera.rotation.x = -0.3;

      var count = 0;
      var render = function() {
        count += 1;
        var rad = (count % 360) * Math.PI / 180;
        mesh.rotation.y = -rad * 3;
        mesh.position.x = Math.sin(rad * 2) * 3;
        mesh.position.z = Math.cos(rad * 2) * 3;
        renderer.render(scene, camera);
        requestAnimationFrame(render);
      }

      render();
    }
  </script>
</body>
</html>
